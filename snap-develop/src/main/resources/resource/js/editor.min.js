var FileEditor;
(function(d){function x(){var a=ace.edit("editor").getSession(),c;for(c in r)if(r.hasOwnProperty(c)){var b=r[c];null!=b&&a.removeMarker(b)}r={}}function y(a){var c=ace.edit("editor");c.resize(!0);1<a?c.scrollToLine(a-1,!0,!0,function(){}):c.scrollToLine(0,!0,!0,function(){})}function z(){var a=[],c=1,b;for(b in n)if(n.hasOwnProperty(b)){var m=n[b],g;for(g in m)if(m.hasOwnProperty(g)&&1==m[g]){var f=FileTree.createResourcePath(b),p="\x3cdiv class\x3d'breakpointEnabled'\x3e"+f.projectPath+"\x3c/div\x3e";
a.push({recid:c++,name:p,location:"Line "+g,resource:f.projectPath,line:parseInt(g),script:f.resourcePath})}}w2ui.breakpoints.records=a;w2ui.breakpoints.refresh();Command.updateScriptBreakpoints()}function C(){var a=ace.edit("editor").getValue();return{breakpoints:n,resource:k,source:a}}function D(a){a=a.toLowerCase();return stringEndsWith(a,".snap")?"ace/mode/snapscript":stringEndsWith(a,".xml")?"ace/mode/xml":stringEndsWith(a,".json")?"ace/mode/json":stringEndsWith(a,".sql")?"ace/mode/sql":stringEndsWith(a,
".js")?"ace/mode/javascript":stringEndsWith(a,".html")||stringEndsWith(a,".htm")?"ace/mode/html":stringEndsWith(a,".txt")?"ace/mode/text":stringEndsWith(a,".properties")?"ace/mode/properties":stringEndsWith(a,".gitignore")?"ace/mode/text":stringEndsWith(a,".project")||stringEndsWith(a,".classpath")?"ace/mode/xml":null}function G(a,c){var b=c.toLowerCase(),m=/(function|static|public|private|abstract|override|)\s+([a-z][a-zA-Z0-9]*)\s*\(/g,g=/(var|const)\s+([a-z][a-zA-Z0-9]*)/g,f=/(class|trait|enum)\s+([A-Z][a-zA-Z0-9]*)/g,
p=/import\s+([a-z][a-zA-Z0-9\.]*)\.([A-Z][a-zA-Z]*)/g,l={};if(stringEndsWith(b,".snap"))for(var b=a.split(/\r?\n/),d=0;d<b.length;d++){var h=b[d];u(h,d+1,m,l,["%s("],!1);u(h,d+1,g,l,"%s.;%s\x3d;%s \x3d;%s\x3c;%s \x3c;%s\x3e;%s \x3e;%s!;%s !;%s-;%s -;%s+;%s +;%s*;%s *;%s%;%s %;%s/;%s /".split(";"),!1);u(h,d+1,p,l,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!0);u(h,d+1,f,l,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),
!1)}v=l;if(null!=w){var e=v[w];null!=e&&(setTimeout(function(){y(e.line)},100),w=null)}}function u(a,c,b,m,d,f){b.lastIndex=0;b=b.exec(a);if(null!=b&&0<b.length){a=b[1];b=b[2];for(var g=0;g<d.length;g++){var l=d[g].replace("%s",b);m[l]=f?{resource:"/"+a.replace(".","/")+".snap",line:c}:{resource:null,line:c}}}}function E(){ace.edit("editor").getSession().setScrollTop(0)}function F(){return{getCompletions:function(a,c,b,m,d){0===m.length?d(null,[]):(c=a.getValue(),a=a.session.getLine(b.row).substring(0,
b.column-m.length),b=JSON.stringify({resource:k.projectPath,line:b.row,complete:a,source:c,prefix:m}),$.ajax({contentType:"application/json",data:b,dataType:"json",success:function(a){a=a.tokens;var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push({name:c,value:c,score:300,meta:a[c]});d(null,b)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title}))}}}function H(){ace.require("ace/ext/language_tools");var a=ace.edit("editor"),c=F();null!=
A&&a.setTheme(A);a.completers=[c];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!0);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.keyBinding.setDefaultHandler(null);a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(b){var c=b.domEvent.target;if(-1!=c.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(b.clientX>25+c.getBoundingClientRect().left)){var d=b.getDocumentPosition().row;
if(null!=k){var f=ace.edit("editor").getSession(),c=n[k.filePath],p=f.getBreakpoints(),l=!1,q;for(q in p)if(q==d){l=!0;break}l?f.clearBreakpoint(d):f.setBreakpoint(d);q=parseInt(d);null==c?(c={},c[q+1]=!0,n[k.filePath]=c):c[q+1]=1==c[q+1]?!1:!0}z();b.stop()}});createEditorLinks(a,I,J);KeyBinder.bindKeys();Project.changeProjectFont();E();LoadSpinner.finish()}function I(a,c){for(var b="\\.[A-Z][a-zA-Z0-9]*; \\sas\\s+[A-Z][a-zA-Z0-9]*; [a-zA-Z][a-zA-Z0-9]*\\s*\\. [a-z][a-zA-Z0-9]*\\s*[\x3d|\x3c|\x3e|!|-|+|*|\\/|%] new\\s+[A-Z][a-zA-Z0-9]*\\s*\\( [a-zA-Z][a-zA-Z0-9]*\\s*\\( [A-Z][a-zA-Z0-9]*\\s*\\[ :\\s*[A-Z][a-zA-Z0-9]* extends\\s+[A-Z][a-zA-Z0-9]* with\\s+[A-Z][a-zA-Z0-9]*".split(" "),
d=0;d<b.length;d++){var g=new RegExp(b[d],"g"),f=null;g.lastIndex=0;a.replace(g,function(a){var b=arguments[arguments.length-2],d=a.length;b<=c&&b+d>=c&&null!=v[a]&&(f={start:b,value:a})});if(null!=f)return f}return null}function J(a){var c=v[a.value];null!=c&&(null!=c.resource?(w=a.value,window.location.hash=c.resource):y(c.line))}var n={},r={},k=null,B=null,A=null,v={},w=null;d.createEditor=function(){window.setTimeout(H,400);createTermination(x)};d.clearEditorHighlights=x;d.showEditorLine=y;d.createEditorHighlight=
function(a,c){var b=ace.edit("editor"),d=ace.require("ace/range").Range,b=b.getSession();x();d=b.addMarker(new d(a-1,0,a-1,1),c,"fullLine");r[a]=d};d.showEditorBreakpoints=z;d.resizeEditor=function(){var a=ace.edit("editor"),c=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+c+"x"+b);a.setAutoScrollEditorIntoView(!0);a.resize(!0)};d.resetEditor=function(){var a=ace.edit("editor"),c=a.getSession();r={};k=null;a.setReadOnly(!0);
c.setValue(B,1);$("#currentFile").html("")};d.loadEditor=C;d.resolveEditorMode=D;d.updateEditor=function(a,c){var b=ace.edit("editor"),d=b.getSession(),g=d.getMode(),f=D(c);a:{var p=a,l=c.toLowerCase();if(stringEndsWith(l,".json"))try{var q=JSON.parse(p);a=JSON.stringify(q,null,3);break a}catch(K){a=p;break a}a=p}f!=g&&d.setMode({path:f,v:Date.now()});d=new ace.UndoManager;b.setReadOnly(!1);b.setValue(a,1);b.getSession().setUndoManager(d);var b=ace.edit("editor").getSession(),h;for(h in b.$backMarkers)b.removeMarker(h);
h=b.getBreakpoints();for(var e in h)b.clearBreakpoint(e);$("#currentFile").html("");E();k=FileTree.createResourcePath(c);r={};B=a;window.location.hash=k.projectPath;highlightProblems();if(null!=c&&(e=n[k.filePath],null!=e))for(var t in e)e.hasOwnProperty(t)&&1==e[t]&&(d=t-1,null!=k&&(h=ace.edit("editor").getSession(),b=n[k.filePath],d=parseInt(d),h.setBreakpoint(d),null==b&&(b={},n[k.filePath]=b),b[d+1]=!0),z());G(a,c);Project.createEditorTab();History.showFileHistory();t=k.projectPath.split("/");
e="\x3ctable border\x3d'0'\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3cdiv class\x3d'treeIndexFolder'\x3e\x3c/div\x3e\x3ctd\x3e\n"+("\x3ctd\x3e"+document.title+"\x3c/td\x3e\n");for(h=0;h<t.length;h++)b=t[h],0<b.length&&(e+="\x3ctd\x3e\x3cdiv class\x3d'",e=-1!=b.indexOf(".")?e+"treeFile":e+"treeFileFolder",e+="'\x3e\x3c/div\x3e",e+="\x3c/td\x3e\n\x3ctd\x3e",e+=b,e+="\x3c/td\x3e\n");e+="\x3c/table\x3e";$("#currentFile").html(e)};d.showEditorFileInTree=function(){var a=C().resource;FileTree.showTreeNode("explorerTree",
a)};d.getSelectedText=function(){return ace.edit("editor").getSelectedText()};d.isEditorChanged=function(){return null!=k?ace.edit("editor").getValue()!=B:!1};d.formatEditorSource=function(){var a=ace.edit("editor"),c=a.getValue();$.ajax({contentType:"text/plain",data:c,success:function(b){a.setReadOnly(!1);a.setValue(b,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title})};d.setEditorTheme=function(a){if(null!=a){var c=ace.edit("editor");null!=
c&&c.setTheme(a);A=a}};d.undoEditorChange=function(){ace.edit("editor").getSession().getUndoManager().undo(!0)};d.redoEditorChange=function(){ace.edit("editor").getSession().getUndoManager().redo(!0)};d.updateEditorFont=function(a,c){ace.require("ace/ext/language_tools");var b=ace.edit("editor"),d=F();b.completers=[d];b.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:c})}})(FileEditor||(FileEditor={}));
ModuleSystem.registerModule("editor","Editor module: editor.js",FileEditor.createEditor,["common","spinner","tree"]);
