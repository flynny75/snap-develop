define("require exports jquery md5 ace w2ui ./common ./socket ./problem ./spinner ./tree ./history ./project ./status ./keys ./commands".split(" "),function(X,p,w,I,e,J,k,P,Q,R,A,S,K,T,U,B){(function(d){function C(){var a=e.ace.edit("editor").getSession(),b;for(b in v)if(v.hasOwnProperty(b)){var c=v[b];null!=c&&a.removeMarker(c)}v={}}function p(a){var b=e.ace.edit("editor");b.resize(!0);1<a?b.scrollToLine(a-1,!0,!0,function(){}):b.scrollToLine(0,!0,!0,function(){})}function D(){var a=[],b=1,c;for(c in n)if(n.hasOwnProperty(c)){var m=
n[c],l;for(l in m)if(m.hasOwnProperty(l)&&1==m[l]){var g=A.FileTree.createResourcePath(c),f="\x3cdiv class\x3d'breakpointEnabled'\x3e"+g.projectPath+"\x3c/div\x3e";a.push({recid:b++,name:f,location:"Line "+l,resource:g.projectPath,line:parseInt(l),script:g.resourcePath})}}J.w2ui.breakpoints.records=a;J.w2ui.breakpoints.refresh();B.Command.updateScriptBreakpoints()}function z(){var a=e.ace.edit("editor"),b;b=e.ace.edit("editor").getSession().getUndoManager();var c=w.extend(!0,{},b.$undoStack),m=w.extend(!0,
{},b.$redoStack);b={undoStack:c,redoStack:m,dirtyCounter:b.dirtyCounter};a=a.getValue();return{breakpoints:n,resource:h,history:b,source:a}}function L(a){a=a.toLowerCase();return k.Common.stringEndsWith(a,".snap")?"ace/mode/snapscript":k.Common.stringEndsWith(a,".xml")?"ace/mode/xml":k.Common.stringEndsWith(a,".json")?"ace/mode/json":k.Common.stringEndsWith(a,".sql")?"ace/mode/sql":k.Common.stringEndsWith(a,".js")?"ace/mode/javascript":k.Common.stringEndsWith(a,".html")||k.Common.stringEndsWith(a,
".htm")?"ace/mode/html":k.Common.stringEndsWith(a,".txt")?"ace/mode/text":k.Common.stringEndsWith(a,".properties")?"ace/mode/properties":k.Common.stringEndsWith(a,".gitignore")?"ace/mode/text":k.Common.stringEndsWith(a,".project")||k.Common.stringEndsWith(a,".classpath")?"ace/mode/xml":"ace/mode/text"}function V(a,b){var c=b.toLowerCase(),m=/(function|static|public|private|abstract|override|)\s+([a-z][a-zA-Z0-9]*)\s*\(/g,l=/(var|const)\s+([a-z][a-zA-Z0-9]*)/g,g=/(class|trait|enum)\s+([A-Z][a-zA-Z0-9]*)/g,
f=/import\s+([a-z][a-zA-Z0-9\.]*)\.([A-Z][a-zA-Z]*)/g,e={};if(k.Common.stringEndsWith(c,".snap"))for(var c=a.split(/\r?\n/),d=0;d<c.length;d++){var h=c[d];t(h,d+1,m,e,["%s("],!1);t(h,d+1,l,e,"%s.;%s\x3d;%s \x3d;%s\x3c;%s \x3c;%s\x3e;%s \x3e;%s!;%s !;%s-;%s -;%s+;%s +;%s*;%s *;%s%;%s %;%s/;%s /".split(";"),!1);t(h,d+1,f,e,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!0);t(h,d+1,g,e,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),
!1)}M=e;if(null!=E){var n=M[E];null!=n&&(setTimeout(function(){p(n.line)},100),E=null)}}function t(a,b,c,m,e,g){c.lastIndex=0;c=c.exec(a);if(null!=c&&0<c.length){a=c[1];c=c[2];for(var f=0;f<e.length;f++){var d=e[f].replace("%s",c);m[d]=g?{resource:"/"+a.replace(".","/")+".snap",line:b}:{resource:null,line:b}}}}function N(){e.ace.edit("editor").getSession().setScrollTop(0)}function O(){return{getCompletions:function(a,b,c,m,e){0===m.length?e(null,[]):(b=a.getValue(),a=a.session.getLine(c.row).substring(0,
c.column-m.length),c=JSON.stringify({resource:h.projectPath,line:c.row,complete:a,source:b,prefix:m}),w.ajax({contentType:"application/json",data:c,dataType:"json",success:function(a){a=a.tokens;var c=[],b;for(b in a)a.hasOwnProperty(b)&&c.push({name:b,value:b,score:300,meta:a[b]});e(null,c)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title}))}}}function W(){u(function(a){var b=O();null!=F&&a.setTheme(F);a.completers=[b];a.getSession().setMode("ace/mode/snapscript");
a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(b){var c=b.domEvent.target;if(-1!=c.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(b.clientX>25+c.getBoundingClientRect().left)){var d=
b.getDocumentPosition().row;if(null!=h){var g=e.ace.edit("editor").getSession(),c=n[h.filePath],f=g.getBreakpoints(),k=!1,r;for(r in f)if(r==d){k=!0;break}k?g.clearBreakpoint(d):g.setBreakpoint(d);r=parseInt(d);null==c?(c={},c[r+1]=!0,n[h.filePath]=c):c[r+1]=1==c[r+1]?!1:!0}D();b.stop()}});U.KeyBinder.bindKeys();K.Project.changeProjectFont();N();R.LoadSpinner.finish();"undefined"!==typeof java&&a.setScrollSpeed(.05)})}function u(a){(function(){if(null!=document.getElementById("editor")){e.ace.require("ace/ext/language_tools");
var b=e.ace.edit("editor");if(null!=b)return a(b),!0}return!1})()||setTimeout(function(){u(a)},100)}var n={},v={},h=null,G=null,F=null,M={},E=null,H={};d.createEditor=function(){W();P.EventBus.createTermination(C)};d.clearEditorHighlights=C;d.showEditorLine=p;d.createEditorHighlight=function(a,b){var c=e.ace.edit("editor"),d=e.ace.require("ace/range").Range,c=c.getSession();C();d=c.addMarker(new d(a-1,0,a-1,1),b,"fullLine");v[a]=d};d.findAndReplaceTextInEditor=function(){var a=z();B.Command.searchAndReplaceFiles(a.resource.projectPath)};
d.findTextInEditor=function(){var a=z();B.Command.searchFiles(a.resource.projectPath)};d.addEditorKeyBinding=function(a,b){e.ace.edit("editor").commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};d.showEditorBreakpoints=D;d.resizeEditor=function(){var a=e.ace.edit("editor"),b=document.getElementById("editor").offsetWidth,c=document.getElementById("editor").offsetHeight;console.log("Resize editor "+b+"x"+c);a.setAutoScrollEditorIntoView(!0);a.resize(!0)};
d.resetEditor=function(){var a=e.ace.edit("editor"),b=a.getSession();v={};h=null;a.setReadOnly(!1);b.setValue(G,1);w("#currentFile").html("")};d.loadEditor=z;d.resolveEditorMode=L;d.updateEditor=function(a,b){var c=e.ace.edit("editor"),d=c.getSession(),l=d.getMode(),g=L(b);a:{var f=a;if(f){var p=b.toLowerCase();if(k.Common.stringEndsWith(p,".json"))try{var r=JSON.parse(f);a=JSON.stringify(r,null,3);break a}catch(Y){}a=f}else a=""}f=z();f.resource&&f.source&&(p=I.md5(f.source),H[f.resource.resourcePath]=
{hash:p,history:f.history});g!=l&&d.setMode({path:g,v:Date.now()});c.setReadOnly(!1);c.setValue(a,1);f=a;c=new e.ace.UndoManager;if(f&&b&&(g=A.FileTree.createResourcePath(b),l=H[g.resourcePath]))if(f=I.md5(f),l.hash==f){var g=l.history.undoStack,f=l.history.redoStack,q;for(q in g)g.hasOwnProperty(q)&&(c.$undoStack[q]=g[q]);for(var t in f)f.hasOwnProperty(t)&&(c.$redoStack[t]=g[t]);c.$doc=d;c.dirtyCounter=l.history.dirtyCounter}else H[g.resourcePath]=null;d.setUndoManager(c);var d=e.ace.edit("editor").getSession(),
x;for(x in d.$backMarkers)d.removeMarker(x);x=d.getBreakpoints();for(var y in x)d.clearBreakpoint(y);w("#currentFile").html("");N();h=A.FileTree.createResourcePath(b);v={};G=a;window.location.hash=h.projectPath;Q.ProblemManager.highlightProblems();if(null!=b&&(y=n[h.filePath],null!=y))for(var u in y)y.hasOwnProperty(u)&&1==y[u]&&(q=u-1,null!=h&&(x=e.ace.edit("editor").getSession(),d=n[h.filePath],q=parseInt(q),x.setBreakpoint(q),null==d&&(d={},n[h.filePath]=d),d[q+1]=!0),D());V(a,b);K.Project.createEditorTab();
S.History.showFileHistory();T.StatusPanel.showActiveFile(h.projectPath)};d.showEditorFileInTree=function(){var a=z().resource;A.FileTree.showTreeNode("explorerTree",a)};d.getSelectedText=function(){return e.ace.edit("editor").getSelectedText()};d.isEditorChanged=function(){return null!=h?e.ace.edit("editor").getValue()!=G:!1};d.formatEditorSource=function(){var a=e.ace.edit("editor"),b=a.getValue();w.ajax({contentType:"text/plain",data:b,success:function(b){a.setReadOnly(!1);a.setValue(b,1)},error:function(){console.log("Format failed")},
processData:!1,type:"POST",url:"/format/"+document.title})};d.setEditorTheme=function(a){u(function(b){null!=a&&(b=e.ace.edit("editor"),null!=b&&b.setTheme(a),F=a)})};d.updateEditorFont=function(a,b){u(function(c){var d=O();c.completers=[d];c.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:b})})}})(p.FileEditor||(p.FileEditor={}))});
