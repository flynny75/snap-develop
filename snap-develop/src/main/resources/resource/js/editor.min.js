define("require exports jquery md5 ace w2ui common socket problem spinner tree history project status keys commands".split(" "),function(O,l,u,D,y,E,h,K,L,z,w,M,F,N,A,B){var G=function(){function c(c,h){this.editorBreakpoints={};this.editorMarkers={};this.editorText=this.editorResource=null;this.editorCurrentTokens={};this.editorFocusToken=null;this.editorHistory={};this.editorPanel=null;this.editorPanel=c;this.editorTheme=h}c.prototype.init=function(){A.KeyBinder.bindKeys();F.Project.changeProjectFont();
q.scrollEditorToTop();z.LoadSpinner.finish()};return c}();l.FileEditorView=G;var q;(function(c){function l(){var a=b.editorPanel.getSession(),f;for(f in b.editorMarkers)if(b.editorMarkers.hasOwnProperty(f)){var d=b.editorMarkers[f];null!=d&&a.removeMarker(d)}b.editorMarkers={}}function q(a){b.editorPanel.resize(!0);1<a?b.editorPanel.scrollToLine(a-1,!0,!0,function(){}):b.editorPanel.scrollToLine(0,!0,!0,function(){})}function C(){var a=[],f=1,d;for(d in b.editorBreakpoints)if(b.editorBreakpoints.hasOwnProperty(d)){var m=
b.editorBreakpoints[d],c;for(c in m)if(m.hasOwnProperty(c)&&1==m[c]){var e=w.FileTree.createResourcePath(d),n="\x3cdiv class\x3d'breakpointEnabled'\x3e"+e.projectPath+"\x3c/div\x3e";a.push({recid:f++,name:n,location:"Line "+c,resource:e.projectPath,line:parseInt(c),script:e.resourcePath})}}E.w2ui.breakpoints.records=a;E.w2ui.breakpoints.refresh();B.Command.updateScriptBreakpoints()}function v(){var a=b.editorPanel.getSession().getUndoManager();u.extend(!0,{},a.$undoStack);u.extend(!0,{},a.$redoStack);
a=b.editorPanel.getValue();return{breakpoints:b.editorBreakpoints,resource:b.editorResource,history:b.editorHistory,source:a}}function H(a){a=a.toLowerCase();return h.Common.stringEndsWith(a,".snap")?"ace/mode/snapscript":h.Common.stringEndsWith(a,".xml")?"ace/mode/xml":h.Common.stringEndsWith(a,".json")?"ace/mode/json":h.Common.stringEndsWith(a,".sql")?"ace/mode/sql":h.Common.stringEndsWith(a,".js")?"ace/mode/javascript":h.Common.stringEndsWith(a,".html")||h.Common.stringEndsWith(a,".htm")?"ace/mode/html":
h.Common.stringEndsWith(a,".txt")?"ace/mode/text":h.Common.stringEndsWith(a,".properties")?"ace/mode/properties":h.Common.stringEndsWith(a,".gitignore")?"ace/mode/text":h.Common.stringEndsWith(a,".project")||h.Common.stringEndsWith(a,".classpath")?"ace/mode/xml":"ace/mode/text"}function z(a,f){var d=f.toLowerCase(),c=/(function|static|public|private|abstract|override|)\s+([a-z][a-zA-Z0-9]*)\s*\(/g,k=/(var|const)\s+([a-z][a-zA-Z0-9]*)/g,e=/(class|trait|enum)\s+([A-Z][a-zA-Z0-9]*)/g,n=/import\s+([a-z][a-zA-Z0-9\.]*)\.([A-Z][a-zA-Z]*)/g,
p={};if(h.Common.stringEndsWith(d,".snap"))for(var d=a.split(/\r?\n/),g=0;g<d.length;g++){var r=d[g];x(r,g+1,c,p,["%s("],!1);x(r,g+1,k,p,"%s.;%s\x3d;%s \x3d;%s\x3c;%s \x3c;%s\x3e;%s \x3e;%s!;%s !;%s-;%s -;%s+;%s +;%s*;%s *;%s%;%s %;%s/;%s /".split(";"),!1);x(r,g+1,n,p,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!0);x(r,g+1,e,p,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!1)}b.editorCurrentTokens=p;if(null!=
b.editorFocusToken){var t=b.editorCurrentTokens[b.editorFocusToken];null!=t&&(setTimeout(function(){q(t.line)},100),b.editorFocusToken=null)}}function x(a,b,d,c,k,e){d.lastIndex=0;d=d.exec(a);if(null!=d&&0<d.length){a=d[1];d=d[2];for(var f=0;f<k.length;f++){var m=k[f].replace("%s",d);c[m]=e?{resource:"/"+a.replace(".","/")+".snap",line:b}:{resource:null,line:b}}}}function I(){b.editorPanel.getSession().setScrollTop(0)}function J(){return{getCompletions:function(a,b,d,c,k){0===c.length?k(null,[]):
(b=a.getValue(),a=a.session.getLine(d.row).substring(0,d.column-c.length),d=JSON.stringify({resource:editorResource.projectPath,line:d.row,complete:a,source:b,prefix:c}),u.ajax({contentType:"application/json",data:d,dataType:"json",success:function(a){a=a.tokens;var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push({name:d,value:d,score:300,meta:a[d]});k(null,b)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title}))}}}function A(){var a=
y.ace.edit("editor"),c=J();a.completers=[c];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(d){var c=d.domEvent.target;if(-1!=c.className.indexOf("ace_gutter-cell")&&
a.isFocused()&&!(d.clientX>25+c.getBoundingClientRect().left)){var f=d.getDocumentPosition().row;if(null!=b.editorResource){var e=b.editorPanel.getSession(),c=b.editorBreakpoints[b.editorResource.filePath],h=e.getBreakpoints(),p=!1,g;for(g in h)if(g==f){p=!0;break}p?e.clearBreakpoint(f):e.setBreakpoint(f);g=parseInt(f);null==c?(c={},c[g+1]=!0,b.editorBreakpoints[b.editorResource.filePath]=c):c[g+1]=1==c[g+1]?!1:!0}C();d.stop()}});"undefined"!==typeof java&&a.setScrollSpeed(.05);return new G(a,editorTheme)}
var b=null;c.createEditor=function(){b=A();b.init();K.EventBus.createTermination(l)};c.clearEditorHighlights=l;c.showEditorLine=q;c.createEditorHighlight=function(a,c){var d=y.ace.require("ace/range").Range,f=b.editorPanel.getSession();l();d=f.addMarker(new d(a-1,0,a-1,1),c,"fullLine");b.editorMarkers[a]=d};c.findAndReplaceTextInEditor=function(){v();B.Command.searchAndReplaceFiles(b.editorData.resource.projectPath)};c.findTextInEditor=function(){v();B.Command.searchFiles(b.editorData.resource.projectPath)};
c.addEditorKeyBinding=function(a,c){b.editorPanel.commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){c&&c()}})};c.showEditorBreakpoints=C;c.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,c=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+c);b.editorPanel.setAutoScrollEditorIntoView(!0);b.editorPanel.resize(!0)};c.resetEditor=function(){var a=b.editorPanel.getSession();b.editorMarkers={};b.editorResource=
null;b.editor.setReadOnly(!1);a.setValue(b.editorText,1);u("#currentFile").html("")};c.loadEditor=v;c.resolveEditorMode=H;c.updateEditor=function(a,f){var d=b.editorPanel.getSession(),m=d.getMode(),k=H(f);a:{var e=a;if(e){var n=f.toLowerCase();if(h.Common.stringEndsWith(n,".json"))try{var p=JSON.parse(e);a=JSON.stringify(p,null,3);break a}catch(P){}a=e}else a=""}e=v();e.resource&&e.source&&(n=D.md5(e.source),b.editorHistory[e.resource.resourcePath]={hash:n,history:e.history});k!=m&&d.setMode({path:k,
v:Date.now()});b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(a,1);e=a;m=new y.ace.UndoManager;if(e&&f&&b.editorResource&&(w.FileTree.createResourcePath(f),k=b.editorHistory[b.editorResource.resourcePath]))if(e=D.md5(e),k.hash==e){var e=k.history.undoStack,n=k.history.redoStack,g;for(g in e)e.hasOwnProperty(g)&&(m.$undoStack[g]=e[g]);for(var r in n)n.hasOwnProperty(r)&&(m.$redoStack[r]=e[r]);m.$doc=d;m.dirtyCounter=k.history.dirtyCounter}else b.editorHistory[b.editorResource.resourcePath]=null;
d.setUndoManager(m);var d=b.editorPanel.getSession(),t;for(t in d.$backMarkers)d.removeMarker(b.editorMarker);t=d.getBreakpoints();for(var l in t)d.clearBreakpoint(l);u("#currentFile").html("");I();b.editorResource=w.FileTree.createResourcePath(f);b.editorMarkers={};b.editorText=a;window.location.hash=b.editorResource.projectPath;L.ProblemManager.highlightProblems();if(null!=f&&b.editorResource&&(l=b.editorBreakpoints[b.editorResource.filePath],null!=l))for(var q in l)l.hasOwnProperty(q)&&1==l[q]&&
(g=q-1,null!=b.editorResource&&(t=b.editorPanel.getSession(),d=b.editorBreakpoints[b.editorResource.filePath],g=parseInt(g),t.setBreakpoint(g),null==d&&(d={},b.editorBreakpoints[b.editorResource.filePath]=d),d[g+1]=!0),C());z(a,f);F.Project.createEditorTab();M.History.showFileHistory();N.StatusPanel.showActiveFile(b.editorResource.projectPath);c.showEditorFileInTree()};c.showEditorFileInTree=function(){var a=v().resource;w.FileTree.showTreeNode("explorerTree",a)};c.getSelectedText=function(){return b.editorPanel.getSelectedText()};
c.isEditorChanged=function(){return null!=b.editorResource?b.editorPanel.getValue()!=b.editorText:!1};c.scrollEditorToTop=I;c.formatEditorSource=function(){var a=b.editorPanel.getValue();u.ajax({contentType:"text/plain",data:a,success:function(a){b.editorPanel.setReadOnly(!1);b.editorPanel.setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title})};c.setEditorTheme=function(a){null!=a&&(null!=b.editorPanel&&b.editorPanel.setTheme(a),b.editorTheme=
a)};c.updateEditorFont=function(a,c){var d=J();b.editorPanel.completers=[d];b.editorPanel.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:c})}})(q=l.FileEditor||(l.FileEditor={}))});
