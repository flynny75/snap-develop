define("require exports jquery md5 ace w2ui common socket problem spinner tree history project status keys commands".split(" "),function(W,p,w,H,f,I,k,P,Q,R,A,S,J,T,U,u){(function(d){function B(){console.log("FileEditor::clearEditorHighlights()");var a=f.ace.edit("editor").getSession(),b;for(b in v)if(v.hasOwnProperty(b)){var c=v[b];null!=c&&a.removeMarker(c)}v={}}function p(a){console.log("FileEditor::showEditorLine("+a+")");var b=f.ace.edit("editor");b.resize(!0);1<a?b.scrollToLine(a-1,!0,!0,function(){}):
b.scrollToLine(0,!0,!0,function(){})}function C(){console.log("FileEditor::showEditorBreakpoints()");var a=[],b=1,c;for(c in q)if(q.hasOwnProperty(c)){var e=q[c],n;for(n in e)if(e.hasOwnProperty(n)&&1==e[n]){var h=A.FileTree.createResourcePath(c),g="\x3cdiv class\x3d'breakpointEnabled'\x3e"+h.projectPath+"\x3c/div\x3e";a.push({recid:b++,name:g,location:"Line "+n,resource:h.projectPath,line:parseInt(n),script:h.resourcePath})}}I.w2ui.breakpoints.records=a;I.w2ui.breakpoints.refresh();u.Command.updateScriptBreakpoints()}
function z(){console.log("FileEditor::loadEditor()");var a=f.ace.edit("editor"),b;console.log("FileEditor::loadEditorHistory()");b=f.ace.edit("editor").getSession().getUndoManager();var c=w.extend(!0,{},b.$undoStack),e=w.extend(!0,{},b.$redoStack);b={undoStack:c,redoStack:e,dirtyCounter:b.dirtyCounter};a=a.getValue();return{breakpoints:q,resource:l,history:b,source:a}}function K(a){console.log("FileEditor::resolveEditorMode("+a+")");a=a.toLowerCase();return k.Common.stringEndsWith(a,".snap")?"ace/mode/snapscript":
k.Common.stringEndsWith(a,".xml")?"ace/mode/xml":k.Common.stringEndsWith(a,".json")?"ace/mode/json":k.Common.stringEndsWith(a,".sql")?"ace/mode/sql":k.Common.stringEndsWith(a,".js")?"ace/mode/javascript":k.Common.stringEndsWith(a,".html")||k.Common.stringEndsWith(a,".htm")?"ace/mode/html":k.Common.stringEndsWith(a,".txt")?"ace/mode/text":k.Common.stringEndsWith(a,".properties")?"ace/mode/properties":k.Common.stringEndsWith(a,".gitignore")?"ace/mode/text":k.Common.stringEndsWith(a,".project")||k.Common.stringEndsWith(a,
".classpath")?"ace/mode/xml":"ace/mode/text"}function V(a,b){console.log("FileEditor::indexEditorTokens("+a.length+", "+b+")");var c=b.toLowerCase(),e=/(function|static|public|private|abstract|override|)\s+([a-z][a-zA-Z0-9]*)\s*\(/g,n=/(var|const)\s+([a-z][a-zA-Z0-9]*)/g,h=/(class|trait|enum)\s+([A-Z][a-zA-Z0-9]*)/g,g=/import\s+([a-z][a-zA-Z0-9\.]*)\.([A-Z][a-zA-Z]*)/g,f={};if(k.Common.stringEndsWith(c,".snap"))for(var c=a.split(/\r?\n/),d=0;d<c.length;d++){var m=c[d];t(m,d+1,e,f,["%s("],!1);t(m,
d+1,n,f,"%s.;%s\x3d;%s \x3d;%s\x3c;%s \x3c;%s\x3e;%s \x3e;%s!;%s !;%s-;%s -;%s+;%s +;%s*;%s *;%s%;%s %;%s/;%s /".split(";"),!1);t(m,d+1,g,f,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!0);t(m,d+1,h,f,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!1)}L=f;if(null!=D){var l=L[D];null!=l&&(setTimeout(function(){p(l.line)},100),D=null)}}function t(a,b,c,e,d,h){console.log("FileEditor::indexEditorLine("+a+", "+b+", "+
c+", "+e+", "+d+", "+h+")");c.lastIndex=0;c=c.exec(a);if(null!=c&&0<c.length){a=c[1];c=c[2];for(var g=0;g<d.length;g++){var f=d[g].replace("%s",c);e[f]=h?{resource:"/"+a.replace(".","/")+".snap",line:b}:{resource:null,line:b}}}}function M(){console.log("FileEditor::scrollEditorToTop()");f.ace.edit("editor").getSession().setScrollTop(0)}function N(){console.log("FileEditor::createEditorAutoComplete()");return{getCompletions:function(a,b,c,e,d){0===e.length?d(null,[]):(b=a.getValue(),a=a.session.getLine(c.row).substring(0,
c.column-e.length),c=JSON.stringify({resource:l.projectPath,line:c.row,complete:a,source:b,prefix:e}),w.ajax({contentType:"application/json",data:c,dataType:"json",success:function(a){a=a.tokens;var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push({name:c,value:c,score:300,meta:a[c]});d(null,b)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title}))}}}function O(){console.log("FileEditor::showEditor()");var a=f.ace.edit("editor"),b=N();
null!=E&&a.setTheme(E);a.completers=[b];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(c){var b=c.domEvent.target;if(-1!=b.className.indexOf("ace_gutter-cell")&&
a.isFocused()&&!(c.clientX>25+b.getBoundingClientRect().left)){var d=c.getDocumentPosition().row;console.log("FileEditor::toggleEditorBreakpoint("+d+")");if(null!=l){var h=f.ace.edit("editor").getSession(),b=q[l.filePath],g=h.getBreakpoints(),k=!1,r;for(r in g)if(r==d){k=!0;break}k?h.clearBreakpoint(d):h.setBreakpoint(d);r=parseInt(d);null==b?(b={},b[r+1]=!0,q[l.filePath]=b):b[r+1]=1==b[r+1]?!1:!0}C();c.stop()}});U.KeyBinder.bindKeys();J.Project.changeProjectFont();M();R.LoadSpinner.finish();"undefined"!==
typeof java&&a.setScrollSpeed(.05)}var q={},v={},l=null,F=null,E=null,L={},D=null,G={};d.createEditor=function(){console.log("FileEditor::createEditor()");O();P.EventBus.createTermination(B)};d.clearEditorHighlights=B;d.showEditorLine=p;d.createEditorHighlight=function(a,b){console.log("FileEditor::createEditorHighlight("+a+", "+b+")");var c=f.ace.edit("editor"),d=f.ace.require("ace/range").Range,c=c.getSession();B();d=c.addMarker(new d(a-1,0,a-1,1),b,"fullLine");v[a]=d};d.findAndReplaceTextInEditor=
function(){console.log("FileEditor::findAndReplaceTextInEditor()");var a=z();u.Command.searchAndReplaceFiles(a.resource.projectPath)};d.findTextInEditor=function(){console.log("FileEditor::findTextInEditor()");var a=z();u.Command.searchFiles(a.resource.projectPath)};d.addEditorKeyBinding=function(a,b){console.log("FileEditor::addEditorKeyBinding("+a+", "+b+")");f.ace.edit("editor").commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};d.showEditorBreakpoints=
C;d.resizeEditor=function(){console.log("FileEditor::resizeEditor()");var a=f.ace.edit("editor"),b=document.getElementById("editor").offsetWidth,c=document.getElementById("editor").offsetHeight;console.log("Resize editor "+b+"x"+c);a.setAutoScrollEditorIntoView(!0);a.resize(!0)};d.resetEditor=function(){console.log("FileEditor::resetEditor()");var a=f.ace.edit("editor"),b=a.getSession();v={};l=null;a.setReadOnly(!1);b.setValue(F,1);w("#currentFile").html("")};d.loadEditor=z;d.resolveEditorMode=K;
d.updateEditor=function(a,b){console.log("FileEditor::updateEditor("+a.length+", "+b+")");var c=f.ace.edit("editor"),e=c.getSession(),n=e.getMode(),h=K(b);a:{var g=a;console.log("FileEditor::encodeEditorText("+g.length+", "+b+")");if(g){var p=b.toLowerCase();if(k.Common.stringEndsWith(p,".json"))try{var r=JSON.parse(g);a=JSON.stringify(r,null,3);break a}catch(X){}a=g}else a=""}console.log("FileEditor::saveEditorHistory()");g=z();g.resource&&g.source&&(p=H.md5(g.source),G[g.resource.resourcePath]=
{hash:p,history:g.history});h!=n&&e.setMode({path:h,v:Date.now()});c.setReadOnly(!1);c.setValue(a,1);g=a;console.log("FileEditor::createEditorUndoManager("+typeof e+", "+g.length+", "+b+")");c=new f.ace.UndoManager;if(g&&b&&(h=A.FileTree.createResourcePath(b),n=G[h.resourcePath]))if(g=H.md5(g),n.hash==g){var h=n.history.undoStack,g=n.history.redoStack,m;for(m in h)h.hasOwnProperty(m)&&(c.$undoStack[m]=h[m]);for(var t in g)g.hasOwnProperty(t)&&(c.$redoStack[t]=h[t]);c.$doc=e;c.dirtyCounter=n.history.dirtyCounter}else G[h.resourcePath]=
null;e.setUndoManager(c);console.log("FileEditor::clearEditor()");var e=f.ace.edit("editor").getSession(),x;for(x in e.$backMarkers)e.removeMarker(x);x=e.getBreakpoints();for(var y in x)e.clearBreakpoint(y);w("#currentFile").html("");M();l=A.FileTree.createResourcePath(b);v={};F=a;window.location.hash=l.projectPath;Q.ProblemManager.highlightProblems();if(null!=b&&(y=q[l.filePath],null!=y))for(var u in y)y.hasOwnProperty(u)&&1==y[u]&&(m=u-1,console.log("FileEditor::setEditorBreakpoint("+m+", true)"),
null!=l&&(x=f.ace.edit("editor").getSession(),e=q[l.filePath],m=parseInt(m),x.setBreakpoint(m),null==e&&(e={},q[l.filePath]=e),e[m+1]=!0),C());V(a,b);J.Project.createEditorTab();S.History.showFileHistory();T.StatusPanel.showActiveFile(l.projectPath);d.showEditorFileInTree()};d.showEditorFileInTree=function(){console.log("FileEditor::showEditorFileInTree()");var a=z().resource;A.FileTree.showTreeNode("explorerTree",a)};d.getSelectedText=function(){console.log("FileEditor::getSelectedText()");return f.ace.edit("editor").getSelectedText()};
d.isEditorChanged=function(){console.log("FileEditor::isEditorChanged()");return null!=l?f.ace.edit("editor").getValue()!=F:!1};d.formatEditorSource=function(){console.log("FileEditor::formatEditorSource()");var a=f.ace.edit("editor"),b=a.getValue();w.ajax({contentType:"text/plain",data:b,success:function(b){a.setReadOnly(!1);a.setValue(b,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+document.title})};d.setEditorTheme=function(a){console.log("FileEditor::setEditorTheme("+
a+")");if(null!=a){var b=f.ace.edit("editor");null!=b&&b.setTheme(a);E=a}};d.showEditor=O;d.updateEditorFont=function(a,b){console.log("FileEditor::updateEditorFont("+a+", "+b+")");var c=f.ace.edit("editor"),d=N();c.completers=[d];c.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:b})}})(p.FileEditor||(p.FileEditor={}))});
