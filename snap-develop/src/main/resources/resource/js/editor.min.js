var FileEditor;
(function(e){function v(){var a=ace.edit("editor").getSession(),c;for(c in p)if(p.hasOwnProperty(c)){var b=p[c];null!=b&&a.removeMarker(b)}p={}}function w(a){var c=ace.edit("editor");c.resize(!0);1<a?c.scrollToLine(a-1,!0,!0,function(){}):c.scrollToLine(0,!0,!0,function(){})}function x(){var a=[],c=1,b;for(b in m)if(m.hasOwnProperty(b)){var d=m[b],h;for(h in d)if(d.hasOwnProperty(h)&&1==d[h]){var l=FileTree.createResourcePath(b),k="\x3cdiv class\x3d'breakpointEnabled'\x3e"+l.projectPath+"\x3c/div\x3e";
a.push({recid:c++,name:k,location:"Line "+h,resource:l.projectPath,line:parseInt(h),script:l.resourcePath})}}w2ui.breakpoints.records=a;w2ui.breakpoints.refresh();Command.updateScriptBreakpoints()}function A(a){a=a.toLowerCase();return a.endsWith(".snap")?"ace/mode/snapscript":a.endsWith(".xml")?"ace/mode/xml":a.endsWith(".json")?"ace/mode/json":a.endsWith(".sql")?"ace/mode/sql":a.endsWith(".js")?"ace/mode/javascript":a.endsWith(".html")||a.endsWith(".htm")?"ace/mode/html":a.endsWith(".txt")?"ace/mode/text":
a.endsWith(".properties")?"ace/mode/properties":a.endsWith(".gitignore")?"ace/mode/text":a.endsWith(".project")||a.endsWith(".classpath")?"ace/mode/xml":null}function D(a,c){var b=/(function|static|public|private|abstract|override|)\s+([a-z][a-zA-Z0-9]*)\s*\(/g,d=/(var|const)\s+([a-z][a-zA-Z0-9]*)/g,h=/(class|trait|enum)\s+([A-Z][a-zA-Z0-9]*)/g,l=/import\s+([a-z][a-zA-Z0-9\.]*)\.([A-Z][a-zA-Z]*)/g,k={};if(c.toLowerCase().endsWith(".snap"))for(var q=a.split(/\r?\n/),f=0;f<q.length;f++){var e=q[f];
n(e,f+1,b,k,["%s("],!1);n(e,f+1,d,k,"%s.;%s\x3d;%s \x3d;%s\x3c;%s \x3c;%s\x3e;%s \x3e;%s!;%s !;%s-;%s -;%s+;%s +;%s*;%s *;%s%;%s %;%s/;%s /".split(";"),!1);n(e,f+1,l,k,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!0);n(e,f+1,h,k,"new %s(,%s.,:%s,: %s,extends %s,with %s,extends  %s,with  %s,.%s;, as %s,%s[".split(","),!1)}t=k;if(null!=u){var g=t[u];null!=g&&(setTimeout(function(){w(g.line)},100),u=null)}}function n(a,c,b,d,h,l){b.lastIndex=0;b=b.exec(a);
if(null!=b&&0<b.length){a=b[1];b=b[2];for(var k=0;k<h.length;k++){var e=h[k].replace("%s",b);d[e]=l?{resource:"/"+a.replace(".","/")+".snap",line:c}:{resource:null,line:c}}}}function B(){ace.edit("editor").getSession().setScrollTop(0)}function C(){return{getCompletions:function(a,c,b,d,h){0===d.length?h(null,[]):(c=a.getValue(),a=a.session.getLine(b.row).substring(0,b.column-d.length),b=JSON.stringify({resource:g.projectPath,line:b.row,complete:a,source:c,prefix:d}),$.ajax({contentType:"application/json",
data:b,dataType:"json",success:function(a){a=a.tokens;var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push({name:c,value:c,score:300,meta:a[c]});h(null,b)},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+document.title}))}}}function E(){ace.require("ace/ext/language_tools");var a=ace.edit("editor"),c=C();null!=y&&a.setTheme(y);a.completers=[c];a.getSession().setMode("ace/mode/snapscript");a.getSession().setTabSize(3);a.setReadOnly(!0);a.setAutoScrollEditorIntoView(!0);
a.getSession().setUseSoftTabs(!0);a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("guttermousedown",function(b){var c=b.domEvent.target;if(-1!=c.className.indexOf("ace_gutter-cell")&&a.isFocused()&&!(b.clientX>25+c.getBoundingClientRect().left)){var h=b.getDocumentPosition().row;if(null!=g){var e=ace.edit("editor").getSession(),c=m[g.filePath],k=e.getBreakpoints(),q=!1,f;for(f in k)if(f==h){q=!0;break}q?e.clearBreakpoint(h):e.setBreakpoint(h);f=parseInt(h);null==c?(c={},
c[f+1]=!0,m[g.filePath]=c):c[f+1]=1==c[f+1]?!1:!0}x();b.stop()}});createEditorLinks(a,F,G);KeyBinder.bindKeys();changeProjectFont();B();LoadSpinner.finish()}function F(a,c){for(var b="\\.[A-Z][a-zA-Z0-9]*; \\sas\\s+[A-Z][a-zA-Z0-9]*; [a-zA-Z][a-zA-Z0-9]*\\s*\\. [a-z][a-zA-Z0-9]*\\s*[\x3d|\x3c|\x3e|!|-|+|*|\\/|%] new\\s+[A-Z][a-zA-Z0-9]*\\s*\\( [a-zA-Z][a-zA-Z0-9]*\\s*\\( [A-Z][a-zA-Z0-9]*\\s*\\[ :\\s*[A-Z][a-zA-Z0-9]* extends\\s+[A-Z][a-zA-Z0-9]* with\\s+[A-Z][a-zA-Z0-9]*".split(" "),d=0;d<b.length;d++){var e=
new RegExp(b[d],"g"),g=null;e.lastIndex=0;a.replace(e,function(a){var b=arguments[arguments.length-2],d=a.length;b<=c&&b+d>=c&&null!=t[a]&&(g={start:b,value:a})});if(null!=g)return g}return null}function G(a){var c=t[a.value];null!=c&&(null!=c.resource?(u=a.value,window.location.hash=c.resource):w(c.line))}var m={},p={},g=null,z=null,y=null,t={},u=null;e.createEditor=function(){window.setTimeout(E,400);createTermination(v)};e.clearEditorHighlights=v;e.showEditorLine=w;e.createEditorHighlight=function(a,
c){var b=ace.edit("editor"),d=ace.require("ace/range").Range,b=b.getSession();v();d=b.addMarker(new d(a-1,0,a-1,1),c,"fullLine");p[a]=d};e.showEditorBreakpoints=x;e.resizeEditor=function(){var a=ace.edit("editor"),c=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+c+"x"+b);a.setAutoScrollEditorIntoView(!0);a.resize(!0)};e.resetEditor=function(){var a=ace.edit("editor"),c=a.getSession();p={};g=null;a.setReadOnly(!0);c.setValue(z,
1);$("#currentFile").html("")};e.loadEditor=function(){var a=ace.edit("editor").getValue();return{breakpoints:m,resource:g,source:a}};e.resolveEditorMode=A;e.updateEditor=function(a,c){var b=ace.edit("editor"),d=b.getSession(),e=d.getMode(),l=A(c);a:{var k=a;if(c.toLowerCase().endsWith(".json"))try{var q=JSON.parse(k);a=JSON.stringify(q,null,3);break a}catch(H){a=k;break a}a=k}l!=e&&d.setMode({path:l,v:Date.now()});d=new ace.UndoManager;b.setReadOnly(!1);b.setValue(a,1);b.getSession().setUndoManager(d);
var b=ace.edit("editor").getSession(),f;for(f in b.$backMarkers)b.removeMarker(f);f=b.getBreakpoints();for(var r in f)b.clearBreakpoint(r);$("#currentFile").html("");B();g=FileTree.createResourcePath(c);p={};z=a;window.location.hash=g.projectPath;highlightProblems();if(null!=c&&(r=m[g.filePath],null!=r))for(var n in r)r.hasOwnProperty(n)&&1==r[n]&&(d=n-1,null!=g&&(f=ace.edit("editor").getSession(),b=m[g.filePath],d=parseInt(d),f.setBreakpoint(d),null==b&&(b={},m[g.filePath]=b),b[d+1]=!0),x());D(a,
c);createEditorTab();$("#currentFile").html("File:\x26nbsp;"+g.projectPath+"\x26nbsp;\x26nbsp;")};e.getSelectedText=function(){return ace.edit("editor").getSelectedText()};e.isEditorChanged=function(){return null!=g?ace.edit("editor").getValue()!=z:!1};e.formatEditorSource=function(){var a=ace.edit("editor"),c=a.getValue();$.ajax({contentType:"text/plain",data:c,success:function(b){a.setReadOnly(!1);a.setValue(b,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+
document.title})};e.setEditorTheme=function(a){if(null!=a){var c=ace.edit("editor");null!=c&&c.setTheme(a);y=a}};e.updateEditorFont=function(a,c){ace.require("ace/ext/language_tools");var b=ace.edit("editor"),d=C();b.completers=[d];b.setOptions({enableBasicAutocompletion:!0,fontFamily:"'"+a+"',monospace",fontSize:c})}})(FileEditor||(FileEditor={}));ModuleSystem.registerModule("editor","Editor module: editor.js",FileEditor.createEditor,["common","spinner","tree"]);
