define(["require","exports","jquery","./common","./commands"],function(w,m,e,p,d){(function(g){function m(a,b,h,f,n,t,u,l){e(document).ready(function(){var c="/tree"+a+"?id\x3d"+h+"\x26folders\x3d"+n+"\x26depth\x3d"+l;null!=f&&(c+="\x26expand\x3d"+f);e.ajax({url:c,success:function(a){e("#"+b).html(a);v(h,!n,t,u)},async:!0})})}function v(a,b,h,f){var n={autoExpandMS:400,focusOnClick:!0,preventVoidMoves:!0,preventRecursiveMoves:!0,dragStart:function(a,b){return!0},dragEnter:function(a,b){return"undefined"!==
typeof d.Command?d.Command.isDragAndDropFilePossible({name:b.otherNode.key,folder:1==b.otherNode.folder},{name:a.key,folder:1==a.folder}):!1},dragDrop:function(a,b){"undefined"!==typeof d.Command&&d.Command.dragAndDropFile({name:b.otherNode.key,folder:1==b.otherNode.folder},{name:a.key,folder:1==a.folder})}};e("#"+a).fancytree({extensions:b?["dnd"]:[],click:f,expand:function(a,b){"undefined"!==typeof d.Command&&d.Command.folderExpand(b.node.key)},collapse:function(a,b){"undefined"!==typeof d.Command&&
d.Command.folderCollapse(b.node.key)},dnd:b?n:null});null!=h&&e("#"+a).contextmenu({delegate:"span.fancytree-title",menu:[{title:"\x26nbsp;New",uiIcon:"menu-new",children:[{title:"\x26nbsp;File",cmd:"newFile",uiIcon:"menu-new"},{title:"\x26nbsp;Directory",cmd:"newDirectory",uiIcon:"menu-new"}]},{title:"\x26nbsp;Save",cmd:"saveFile",uiIcon:"menu-save"},{title:"\x26nbsp;Rename",cmd:"renameFile",uiIcon:"menu-rename"},{title:"\x26nbsp;Delete",cmd:"deleteFile",uiIcon:"menu-trash",disabled:!1},{title:"\x26nbsp;Run",
cmd:"runScript",uiIcon:"menu-run"},{title:"\x26nbsp;Explore",cmd:"exploreDirectory",uiIcon:"menu-explore"}],beforeOpen:function(a,b){e.ui.fancytree.getNode(b.target).setActive();b.menu.zIndex(e(a.target).zIndex()+2E3)},select:function(a,b){var f=e.ui.fancytree.getNode(b.target),c=q(f.tooltip);h(c,b.cmd,b.key,f.isFolder())}})}function r(a){if(!p.Common.stringEndsWith(a,"/")){var b=a.split(".");return 1===a.length||""===b[0]&&2===b.length?!0:0<=b.pop().indexOf("/")}return!0}function k(a){if(null!=a){for(a=
a.replace(/\/+/,"/").replace(/\.#/,"");-1!=a.indexOf("//");)a=a.replace("//","/");p.Common.stringEndsWith(a,"/")&&(a=a.substring(0,a.length-1));return a}return null}function q(a){for(var b="/resource/"+document.title+"/",h="/resource/"+document.title;-1!=a.indexOf("//");)a=a.replace("//","/");if(a==h||a==b)return a={resourcePath:b,projectPath:"/",projectDirectory:"/",filePath:"/",fileName:null,fileDirectory:"/",originalPath:a},JSON.stringify(a),a;0==!a.indexOf("/")&&(a="/"+a);0==!a.indexOf(b)&&(a=
"/resource/"+document.title+a);for(var f=r(a),b=a.split("/"),h="/resource/"+document.title,e="",d="",g="",l="",c=3;c<b.length;c++)h+="/"+b[c],e+="/"+b[c],g+="/"+b[c];if(f)if(f=b[b.length-1],3<b.length)for(c=3;c<b.length;c++)d+="/"+b[c],l+="/"+b[c];else l="/";else if(f=b[b.length-1],4<b.length)for(c=3;c<b.length-1;c++)d+="/"+b[c],l+="/"+b[c];else l="/";a={resourcePath:k(h),projectPath:k(e),projectDirectory:k(""==d?"/":d),filePath:k(g),fileName:k(f),fileDirectory:k(l),originalPath:a};JSON.stringify(a);
return a}g.createTree=function(a,b,d,f,e,g,k){m(a,b,d,f,e,g,k,1E4)};g.createTreeOfDepth=m;g.showTreeNode=function(a,b){a&&b&&b.resourcePath&&e("#"+a).fancytree("getTree").getNodeByKey(b.resourcePath).setActive()};g.isResourceFolder=r;g.cleanResourcePath=k;g.createResourcePath=q})(m.FileTree||(m.FileTree={}))});
