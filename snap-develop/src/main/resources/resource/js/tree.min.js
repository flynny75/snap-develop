define(["require","exports","jquery","common","commands"],function(x,m,g,n,f){(function(h){function m(a,b,e,c,p,u,v,k){g(document).ready(function(){var d="/tree"+a+"?id\x3d"+e+"\x26folders\x3d"+p+"\x26depth\x3d"+k;null!=c&&(d+="\x26expand\x3d"+c);g.ajax({url:d,success:function(a){g("#"+b).html(a);w(e,!p,u,v)},async:!0})})}function q(a,b){var e=document.getElementById("browseParent"),c=g("#"+a).fancytree("getTree");c&&"function"===typeof c.getNodeByKey&&(c=c.getNodeByKey(b))&&(c.li&&e&&!n.Common.isChildElementVisible(e,
c.li)&&(e.scrollTop=0,e.scrollTop=n.Common.calculateScrollOffset(e,c.li)),c.setActive())}function w(a,b,e,c){var p={autoExpandMS:400,focusOnClick:!0,preventVoidMoves:!0,preventRecursiveMoves:!0,dragStart:function(a,b){return!0},dragEnter:function(a,b){return"undefined"!==typeof f.Command?f.Command.isDragAndDropFilePossible({name:b.otherNode.key,folder:1==b.otherNode.folder},{name:a.key,folder:1==a.folder}):!1},dragDrop:function(a,b){"undefined"!==typeof f.Command&&f.Command.dragAndDropFile({name:b.otherNode.key,
folder:1==b.otherNode.folder},{name:a.key,folder:1==a.folder})}};g("#"+a).fancytree({extensions:b?["dnd"]:[],click:c,expand:function(a,b){"undefined"!==typeof f.Command&&f.Command.folderExpand(b.node.key)},collapse:function(a,b){"undefined"!==typeof f.Command&&f.Command.folderCollapse(b.node.key)},dnd:b?p:null});null!=e&&g("#"+a).contextmenu({delegate:"span.fancytree-title",menu:[{title:"\x26nbsp;New",uiIcon:"menu-new",children:[{title:"\x26nbsp;File",cmd:"newFile",uiIcon:"menu-new"},{title:"\x26nbsp;Directory",
cmd:"newDirectory",uiIcon:"menu-new"}]},{title:"\x26nbsp;Save",cmd:"saveFile",uiIcon:"menu-save"},{title:"\x26nbsp;Rename",cmd:"renameFile",uiIcon:"menu-rename"},{title:"\x26nbsp;Delete",cmd:"deleteFile",uiIcon:"menu-trash",disabled:!1},{title:"\x26nbsp;Run",cmd:"runScript",uiIcon:"menu-run"},{title:"\x26nbsp;Explore",cmd:"exploreDirectory",uiIcon:"menu-explore"}],beforeOpen:function(a,b){g.ui.fancytree.getNode(b.target).setActive();b.menu.zIndex(g(a.target).zIndex()+2E3)},select:function(a,b){var c=
g.ui.fancytree.getNode(b.target),d=r(c.tooltip);e(d,b.cmd,b.key,c.isFolder())}})}function t(a){if(!n.Common.stringEndsWith(a,"/")){var b=a.split(".");return 1===a.length||""===b[0]&&2===b.length?!0:0<=b.pop().indexOf("/")}return!0}function l(a){if(null!=a){for(a=a.replace(/\/+/,"/").replace(/\.#/,"");-1!=a.indexOf("//");)a=a.replace("//","/");n.Common.stringEndsWith(a,"/")&&(a=a.substring(0,a.length-1));return a}return null}function r(a){for(var b="/resource/"+document.title+"/",e="/resource/"+document.title;-1!=
a.indexOf("//");)a=a.replace("//","/");if(a==e||a==b)return a={resourcePath:b,projectPath:"/",projectDirectory:"/",filePath:"/",fileName:null,fileDirectory:"/",originalPath:a},JSON.stringify(a),a;0==!a.indexOf("/")&&(a="/"+a);0==!a.indexOf(b)&&(a="/resource/"+document.title+a);for(var c=t(a),b=a.split("/"),e="/resource/"+document.title,g="",f="",h="",k="",d=3;d<b.length;d++)e+="/"+b[d],g+="/"+b[d],h+="/"+b[d];if(c)if(c=b[b.length-1],3<b.length)for(d=3;d<b.length;d++)f+="/"+b[d],k+="/"+b[d];else k=
"/";else if(c=b[b.length-1],4<b.length)for(d=3;d<b.length-1;d++)f+="/"+b[d],k+="/"+b[d];else k="/";a={resourcePath:l(e),projectPath:l(g),projectDirectory:l(""==f?"/":f),filePath:l(h),fileName:l(c),fileDirectory:l(k),originalPath:a};JSON.stringify(a);return a}h.createTree=function(a,b,e,c,f,g,h){m(a,b,e,c,f,g,h,1E4)};h.createTreeOfDepth=m;h.showTreeNode=function(a,b){a&&b&&b.resourcePath&&(q(a,b.resourcePath),q(a,b.resourcePath))};h.isResourceFolder=t;h.cleanResourcePath=l;h.createResourcePath=r})(m.FileTree||
(m.FileTree={}))});
